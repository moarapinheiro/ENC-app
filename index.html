<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enteral Nutrition Calculation</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1e3a8a">

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

body{
    font-family: 'Inter', sans-serif;
    margin:0;
    background:linear-gradient(160deg,#0f172a,#0b1220);
    color:#e2e8f0;
}

header{
    background:rgba(30,58,138,0.85);
    color:white;
    padding:22px;
    text-align:center;
    font-size:20px;
    font-weight:600;
}

.tabs{
  display:flex;
  background:#111827;
}

.tabButton{
  flex:1;
  padding:16px;
  border:none;
  background:#111827;
  font-size:15px;
  color:#94a3b8;
  cursor:pointer;
}

.tabButton.active{
  background:#1e40af;
  color:white;
}

.container{
    padding:20px;
}

.card{
    background:rgba(30,41,59,0.6);
    padding:22px;
    margin-bottom:20px;
    border-radius:18px;
}

input{
    width:100%;
    padding:14px;
    margin-top:8px;
    margin-bottom:15px;
    border-radius:12px;
    border:1px solid #334155;
    background:#0f172a;
    color:white;
    font-size:16px;
}

button{
    width:100%;
    padding:15px;
    background:linear-gradient(135deg,#2563eb,#1e40af);
    color:white;
    border:none;
    border-radius:14px;
    font-size:17px;
    font-weight:600;
    cursor:pointer;
    margin-top:10px;
}

table{
    width:100%;
    border-collapse:collapse;
    font-size:16px;
}

th, td{
    padding:8px;
    text-align:center;
}

th{
    border-bottom:2px solid #334155;
}

.highlight{
    color:#22c55e;
    font-weight:600;
}
</style>
</head>
<body>

<header>ü•º Enteral Nutrition Calculation</header>

<div class="tabs">
  <button class="tabButton active" onclick="voltarParaPleno()">Volume Pleno</button>
  <button class="tabButton" onclick="irParaResultados()">Resultados</button>
</div>

<div class="container">

<!-- VOLUME PLENO -->
<div id="pleno">
<div class="card">

<h3>üßÆ C√°lculo Volume Pleno</h3>

Peso (kg)
<input type="number" id="peso">

Altura (m)
<input type="number" step="0.01" id="altura">

Meta Cal√≥rica (kcal/kg)
<input type="number" id="metaKcal">

Meta Proteica (g/kg)
<input type="number" id="metaProt">

<button onclick="calcularPleno()">Calcular</button>

</div>
</div>

<!-- RESULTADOS -->
<div id="resultados" style="display:none;">
  <div class="card">
    <h3>üìä Resultados da Prescri√ß√£o</h3>
    <div id="resultadoFinal"></div>
    <button onclick="voltarParaPleno()">‚¨Ö Voltar para Volume Pleno</button>
  </div>
</div>

</div>

<script>

function irParaResultados() {
    document.getElementById("pleno").style.display = "none";
    document.getElementById("resultados").style.display = "block";
    atualizarTabs(1);
}

function voltarParaPleno() {
    document.getElementById("pleno").style.display = "block";
    document.getElementById("resultados").style.display = "none";
    atualizarTabs(0);
}

function atualizarTabs(index){
    document.querySelectorAll(".tabButton").forEach(btn => btn.classList.remove("active"));
    document.querySelectorAll(".tabButton")[index].classList.add("active");
}

function classificarIMC(imc){
  if(imc < 18.5) return "Baixo peso";
  if(imc < 25) return "Eutrofia";
  if(imc < 30) return "Sobrepeso";
  if(imc < 35) return "Obesidade Grau I";
  if(imc < 40) return "Obesidade Grau II";
  return "Obesidade Grau III";
}

function calcularPleno(){

let peso = parseFloat(document.getElementById("peso").value);
let altura = parseFloat(document.getElementById("altura").value);
let metaKcal = parseFloat(document.getElementById("metaKcal").value);
let metaProt = parseFloat(document.getElementById("metaProt").value);

if(!peso || !metaKcal || !metaProt){
  alert("Preencha todos os campos");
  return;
}

let metaKcalTotal = peso * metaKcal;
let metaProtTotal = peso * metaProt;

let dietas = [
  {nome:"Tipo 1", densidade:1.2, protMl:0.045},
  {nome:"Tipo 2 s/ fibra", densidade:1.5, protMl:0.075},
  {nome:"Tipo 2 c/ fibra", densidade:1.25, protMl:0.063},
  {nome:"Imunomoduladora", densidade:1.09, protMl:0.065}
];

let imc = altura ? peso/(altura*altura) : null;
let imcTexto = imc ? imc.toFixed(1) + " (" + classificarIMC(imc) + ")" : "-";

let menorVolume = Infinity;

dietas.forEach(d => {
   let volume = metaKcalTotal / d.densidade;
   if(volume < menorVolume) menorVolume = volume;
});

let linhas = "";

dietas.forEach(d => {

let volume = metaKcalTotal / d.densidade;
let protDieta = volume * d.protMl;
let modulo = Math.max(0, metaProtTotal - protDieta);
let ofertaCal = volume * d.densidade;
let ofertaProt = protDieta + modulo;

let classe = volume === menorVolume ? "class='highlight'" : "";

linhas += `
<tr ${classe}>
<td style="text-align:left">${d.nome}</td>
<td>${volume.toFixed(0)} mL/dia</td>
<td>${modulo.toFixed(1)} g</td>
<td>${ofertaCal.toFixed(0)} kcal</td>
<td>${ofertaProt.toFixed(1)} g</td>
</tr>
`;
});

document.getElementById("resultadoFinal").innerHTML = `
<div style="font-size:18px; line-height:1.6;">
<b>IMC:</b> ${imcTexto}<br>
<b>Meta cal√≥rica total:</b> ${metaKcalTotal.toFixed(0)} kcal/dia<br>
<b>Meta proteica total:</b> ${metaProtTotal.toFixed(1)} g/dia<br><br>

<table>
<tr>
<th style="text-align:left;">Dieta</th>
<th>Volume</th>
<th>M√≥dulo</th>
<th>Oferta Kcal</th>
<th>Oferta Prot</th>
</tr>
${linhas}
</table>

<br>
<span class="highlight">‚óè Menor volume necess√°rio</span>
</div>
`;

irParaResultados();
}

if('serviceWorker' in navigator){
  navigator.serviceWorker.register('service-worker.js');
}

</script>

</body>
</html>